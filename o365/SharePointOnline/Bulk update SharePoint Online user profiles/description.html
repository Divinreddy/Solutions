<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/67b74b86-a273-4ad7-9ed5-0f97276412eaCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Bulk update SharePoint Online user profiles</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Bulk update SharePoint Online user profiles</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            C#, Web Services, Office 365, Sharepoint Online, Claims Authentication
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Bulk Update, User Profiles
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Cloud
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">1/6/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/Bulk-update-SharePoint-c2dec76a">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<p>This sample code show how user profiles in SharePoint Online can be updated via the legacy SOAP web service. It also provides information how the authentication procedure works in SharePoint Online. Through the limitation to the user profile REST API this
 is the only way to update.</p>
<p>In Office 365 the authentication is a bit different and an authentication cookie needs to be passed.</p>
<p>The longer explanation how to authentication against Office 365 work can be found in the MSDN article
<a href="http://msdn.microsoft.com/en-us/library/hh147177(v=office.14).aspx">Remote Authentication in SharePoint Online Using Claims-Based Authentication</a>. Another great source of information is the blog post &ldquo;<a href="http://www.wictorwilen.se/post/How-to-do-active-authentication-to-Office-365-and-SharePoint-Online.aspx">How
 to do active authentication to Office 365 and SharePoint Online</a>&rdquo; by Wictor Wil&eacute;n. In this article Wictor provides a helper object that make the authentication process easy. His solution is mainly targeted on SharePoint 2010 in Office 365 but
 this still works in the recent version of SharePoint Online.</p>
<p><em>The Authentication against SharePoint Online Web Services is much simpler now and is also covered in this sample. The new introduced authentication object
<a href="http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.client.sharepointonlinecredentials.aspx">
SharePointOnlineCredentials.</a>&nbsp;</em></p>
<p>&nbsp;</p>
<p><em>The followin code provides the basic steps to do this.</em></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">// Pass the username and password to SharePointOnlineCredentials constructor
// Password needs to be passed as a <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Security.SecureString.aspx"  title="Auto generated link to System.Security.SecureString">System.Security.SecureString</a>
SharePointOnlineCredentials onlineCred = new SharePointOnlineCredentials(_username, mySecurePassword);

// Get the authentication cookie by passing the url of the web service
string authCookie = onlineCred.GetAuthenticationCookie(_adminUrl);

// Create a CookieContainer to authenticate against the web service
CookieContainer authContainer = new CookieContainer();

// Put the authenticationCookie string in the container
authContainer.SetCookies(_adminUrl, _authCookie);

// Setting up the user profile web service
UserProfileWS.UserProfileService upService = new UserProfileWS.UserProfileService();

// assign the correct url to the web service
upService.Url = _adminUrl.AbsoluteUri;

// Assign previously created auth container to web service
upService.CookieContainer = authContainer;
</pre>
<div class="preview">
<pre class="csharp"><span class="cs__com">//&nbsp;Pass&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;SharePointOnlineCredentials&nbsp;constructor</span>&nbsp;
<span class="cs__com">//&nbsp;Password&nbsp;needs&nbsp;to&nbsp;be&nbsp;passed&nbsp;as&nbsp;a&nbsp;<a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Security.SecureString.aspx"  title="Auto generated link to System.Security.SecureString">System.Security.SecureString</a></span>&nbsp;
SharePointOnlineCredentials&nbsp;onlineCred&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;SharePointOnlineCredentials(_username,&nbsp;mySecurePassword);&nbsp;
&nbsp;
<span class="cs__com">//&nbsp;Get&nbsp;the&nbsp;authentication&nbsp;cookie&nbsp;by&nbsp;passing&nbsp;the&nbsp;url&nbsp;of&nbsp;the&nbsp;web&nbsp;service</span>&nbsp;
<span class="cs__keyword">string</span>&nbsp;authCookie&nbsp;=&nbsp;onlineCred.GetAuthenticationCookie(_adminUrl);&nbsp;
&nbsp;
<span class="cs__com">//&nbsp;Create&nbsp;a&nbsp;CookieContainer&nbsp;to&nbsp;authenticate&nbsp;against&nbsp;the&nbsp;web&nbsp;service</span>&nbsp;
CookieContainer&nbsp;authContainer&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;CookieContainer();&nbsp;
&nbsp;
<span class="cs__com">//&nbsp;Put&nbsp;the&nbsp;authenticationCookie&nbsp;string&nbsp;in&nbsp;the&nbsp;container</span>&nbsp;
authContainer.SetCookies(_adminUrl,&nbsp;_authCookie);&nbsp;
&nbsp;
<span class="cs__com">//&nbsp;Setting&nbsp;up&nbsp;the&nbsp;user&nbsp;profile&nbsp;web&nbsp;service</span>&nbsp;
UserProfileWS.UserProfileService&nbsp;upService&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;UserProfileWS.UserProfileService();&nbsp;
&nbsp;
<span class="cs__com">//&nbsp;assign&nbsp;the&nbsp;correct&nbsp;url&nbsp;to&nbsp;the&nbsp;web&nbsp;service</span>&nbsp;
upService.Url&nbsp;=&nbsp;_adminUrl.AbsoluteUri;&nbsp;
&nbsp;
<span class="cs__com">//&nbsp;Assign&nbsp;previously&nbsp;created&nbsp;auth&nbsp;container&nbsp;to&nbsp;web&nbsp;service</span>&nbsp;
upService.CookieContainer&nbsp;=&nbsp;authContainer;&nbsp;</pre>
</div>
</div>
</div>
<ul>
</ul>
<h1>How it works</h1>
<p>The data will be imported from a tab separated text file. The following amage shows the update working.</p>
<p><img id="106529" src="description/command-line-import.jpg" alt="" width="676" height="343"></p>
<h1>More Information</h1>
<p><em>I wrote a blog post that covers all the parts in this solution. This can be found under the title &quot;<a href="http://www.n8d.at/blog/bulk-update-sharepoint-user-profiles-in-office-365/">Bulk update SharePoint User Profiles in Office 365</a>&quot;&nbsp;</em></p>

</div>


    </div>
</body>
</html>
